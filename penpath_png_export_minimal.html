<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ペン軌跡PNG保存（z=1のみ）</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#fff;margin:20px}
textarea{width:100%;height:180px;font-family:ui-monospace,monospace}
button{padding:10px 14px;margin:8px 6px 8px 0;font-size:14px}
canvas{border:1px solid #ccc;margin-top:10px}
</style>
</head>
<body>

<h2>ペン軌跡PNG保存（z=1のみ）</h2>

<p>penPath（JSON）を貼り付け：</p>
<textarea id="txt">[
{"x":10,"y":10,"z":1},
{"x":60,"y":10,"z":1},
{"x":60,"y":60,"z":1},
{"x":10,"y":60,"z":1},
{"x":10,"y":10,"z":1}
]</textarea><br>

<button onclick="render()">描画</button>
<button onclick="savePNG()">PNG保存</button>

<br>
<canvas id="cv" width="800" height="800"></canvas>

<script>
const cv=document.getElementById("cv");
const ctx=cv.getContext("2d");

function render(){
  ctx.clearRect(0,0,cv.width,cv.height);
  let penPath;
  try{
    penPath=JSON.parse(document.getElementById("txt").value);
  }catch(e){
    alert("JSONとして読めません");
    return;
  }
  ctx.strokeStyle="#000";
  ctx.lineWidth=2;
  ctx.lineCap="round";
  ctx.lineJoin="round";

  ctx.beginPath();
  let first=true;
  for(const p of penPath){
    if(p.z!==1){ first=true; continue; }
    if(first){
      ctx.moveTo(p.x,p.y);
      first=false;
    }else{
      ctx.lineTo(p.x,p.y);
    }
  }
  ctx.stroke();
}

function savePNG(){
  const url=cv.toDataURL("image/png");
  const w=window.open("");
  if(!w){ alert("ポップアップがブロックされました"); return; }
  w.document.write('<img src="'+url+'" style="max-width:100%">');
}

render();
</script>

</body>
</html>