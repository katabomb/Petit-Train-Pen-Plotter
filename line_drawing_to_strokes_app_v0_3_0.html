<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ç·šæ–‡ãƒ¡ãƒ¼ã‚«ãƒ¼ v0.3.0ï¼ˆåº§æ¨™ç³»ãƒªã‚»ãƒƒãƒˆç‰ˆï¼‰</title>
<style>
:root{--bg:#fff;--ink:#000;--line:#ddd;--btn:#f4f4f4;--accent:#0b66ff}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto;background:#fff;color:#000}
header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:10px}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
button,select,input{border:1px solid var(--line);background:var(--btn);border-radius:8px;padding:6px 10px}
button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
main{padding:10px}
.canvasWrap{border:1px solid var(--line);border-radius:10px;max-width:520px;margin:0 auto}
canvas{display:block;width:100%;aspect-ratio:1/1;background:#fff;touch-action:none}
textarea{width:100%;min-height:160px;margin-top:10px;border:1px solid var(--line);border-radius:8px;padding:8px;font-family:monospace}
</style>
</head>
<body>

<header>
<div class="row">
<select id="frameSel">
<option value="65">æ  65mm</option>
<option value="70" selected>æ  70mm</option>
<option value="72">æ  72mm</option>
<option value="75">æ  75mm</option>
</select>
<select id="originSel">
<option value="center" selected>åŸç‚¹ï¼šä¸­å¤®</option>
<option value="bottomleft">åŸç‚¹ï¼šå·¦ä¸‹</option>
</select>
<button id="undo">â†©ï¸ æˆ»ã™</button>
<button id="clear">ğŸ§½ å…¨æ¶ˆå»</button>
<button class="primary" id="export">ç·šæ–‡ç”Ÿæˆ</button>
</div>
</header>

<main>
<div class="canvasWrap">
<canvas id="c"></canvas>
</div>
<textarea id="out" placeholder="ã“ã“ã«ç·šæ–‡ï¼ˆx,yï¼‰ãŒå‡ºã¾ã™"></textarea>
</main>

<script>
const c=document.getElementById("c");
const ctx=c.getContext("2d");
const frameSel=document.getElementById("frameSel");
const originSel=document.getElementById("originSel");
const out=document.getElementById("out");

let strokes=[], cur=null, drawing=false;

function resize(){
 const size=c.parentElement.clientWidth;
 c.width=c.height=size;
 redraw();
}
window.addEventListener("resize",resize);

function redraw(){
 ctx.clearRect(0,0,c.width,c.height);
 ctx.strokeStyle="#bbb";
 ctx.strokeRect(0,0,c.width,c.height);

 ctx.strokeStyle="#000";
 ctx.lineWidth=2;
 ctx.lineCap="round";
 ctx.lineJoin="round";
 for(const s of strokes){
   ctx.beginPath();
   ctx.moveTo(s[0].x,s[0].y);
   for(let i=1;i<s.length;i++) ctx.lineTo(s[i].x,s[i].y);
   ctx.stroke();
 }
 if(cur && cur.length>1){
   ctx.beginPath();
   ctx.moveTo(cur[0].x,cur[0].y);
   for(let i=1;i<cur.length;i++) ctx.lineTo(cur[i].x,cur[i].y);
   ctx.stroke();
 }
}

function pos(e){
 return {x:e.offsetX, y:e.offsetY};
}

c.addEventListener("pointerdown",e=>{
 drawing=true;
 cur=[pos(e)];
 redraw();
});
c.addEventListener("pointermove",e=>{
 if(!drawing) return;
 const p=pos(e);
 const l=cur[cur.length-1];
 if(Math.hypot(p.x-l.x,p.y-l.y)>1){
   cur.push(p);
   redraw();
 }
});
c.addEventListener("pointerup",()=>{
 if(cur&&cur.length>1) strokes.push(cur);
 cur=null; drawing=false; redraw();
});

document.getElementById("undo").onclick=()=>{strokes.pop(); redraw();};
document.getElementById("clear").onclick=()=>{strokes=[]; cur=null; out.value=""; redraw();};

document.getElementById("export").onclick=()=>{
 const mm=+frameSel.value;
 const scale=c.width/mm;
 let lines=[];
 for(const s of strokes){
   let prev=null;
   for(const p of s){
     let x=p.x/scale;
     let y=(c.height-p.y)/scale;
     if(originSel.value==="center"){x-=mm/2; y-=mm/2;}
     if(prev && Math.hypot(x-prev[0],y-prev[1])<0.4) continue;
     prev=[x,y];
     lines.push(`${x.toFixed(2)},${y.toFixed(2)}`);
   }
   lines.push("");
 }
 while(lines.at(-1)==="") lines.pop();
 out.value=lines.join("\\n");
};

resize();
</script>
</body>
</html>
